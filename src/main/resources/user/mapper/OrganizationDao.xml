<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
          "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dzfp.cloud.common.dao.OrganizationDao">
	<!-- 查询用户自定义组织机构数据 -->
	 <select id="queryYhzdyZzjg"  resultType="java.util.HashMap"  parameterType="java.util.Map">
	      SELECT
			t.nsrsbh id,
			t.nsrmc name,
			t.jdh,
			t.jdlx,
			t.s_nsrsbh pId,
		    (select tt.nsrmc from spu_t_yhzdy_zzjg tt where tt.nsrsbh=t.s_nsrsbh) s_jdmc,
			t.ssjt_nsrsbh,
			t.jdjc,
		    t.open,
		    t.yxbz,
			a.sfcp 
		FROM
			spu_t_yhzdy_zzjg t
		left join spu_t_zhxx a on t.nsrsbh = a.nsrsbh
		WHERE 1 = 1
		<if test="ssjt_nsrsbh !=null and ssjt_nsrsbh !='' ">
	 		and t.ssjt_nsrsbh = #{ssjt_nsrsbh}
	 	</if>
	 	<if test="jdid!=null and jdid!='' ">
	 		and t.nsrsbh = #{jdid}
	 	</if>	
		    <!-- and t.yxbz='Y' -->
	 </select>
	 
	<!-- 修改节点信息 -->
  	<update id="updateYhzdyZzjg" parameterType="java.util.Map">
    	update spu_t_yhzdy_zzjg set nsrsbh=#{jdid},nsrmc=#{jdmc},jdh=#{jdid},yxbz=#{yxbz},xgsj=now() where nsrsbh=#{old_nsrsbh} and ssjt_nsrsbh=#{ssjt_nsrsbh}
 	</update>
 	
 	<!-- 保存组织架构数据 -->
	<insert id="insertYhzdyZzjg" parameterType="java.util.Map">
		insert into spu_t_yhzdy_zzjg (nsrsbh,nsrmc,jdh,jdlx,s_nsrsbh,ssjt_nsrsbh,jdjc,lrsj,yxbz,open)
		values(#{jdid},#{jdmc},#{jdh},#{jdlx},#{s_jdid},#{ssjt_nsrsbh},#{jdjc},now(),#{yxbz},'false')
	</insert>
	
	<!-- 查询节点账号信息 -->
  	<select id="queryJdmc" parameterType="java.util.Map" resultType="java.util.HashMap">
    	select zhid,nsrsbh,nsrmc,zhzt,lxdh,dz,yx,yxq_q,yxq_z,zhbs,ssjtnsrsbh,sfcp from spu_t_zhxx where ssjtnsrsbh=#{ssjt_nsrsbh} and zhzt='0'
  	</select>
  	
  	 <!-- 删除用户自定义组织机构 -->
 	<delete id="deleteYhzdyZzjg" parameterType="java.util.Map" flushCache="false"> 
    	delete from spu_t_yhzdy_zzjg where ssjt_nsrsbh=#{ssjt_nsrsbh} and nsrsbh=#{nsrsbh}
 	</delete>
</mapper>