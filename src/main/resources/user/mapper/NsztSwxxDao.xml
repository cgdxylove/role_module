<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
          "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dzfp.cloud.user.dao.NsztSwxxDao">
	<!--列表查询 -->
	<select id="queryNsztSwxxList" parameterType="java.util.Map" resultType="java.util.HashMap">
		select 
			uuid,nsrsbh,gsmc,lx,ywx,date_format(sxsj,'%Y-%m-%d') as sxsj,sshy,sykjzd,zggsjg,
			gsdtdz,gszgyxm,gszgydh,zgdsjg,dsdtdz,dszgy,dszgydh,
			bsr,cwfzr,gpr,hdszsm,cjr,cjsj,xgr,xgsj
		from  t_pt_nszt_swxx s
		where 1=1

		<if test="gsmc !=null and gsmc !='' ">
			and s.gsmc like  concat(concat('%',#{gsmc}),'%')
		</if>
		<if test="lx !=null and lx !='' ">
			and s.lx = #{lx}
		</if>
		<if test="nsrsbh !=null and nsrsbh!=''">
			and s.nsrsbh like  concat(concat('%',#{nsrsbh}),'%')
		</if>
		<if test=" sykjzd!=null and  sykjzd!=''">
			and s.sykjzd like  concat(concat('%',#{sykjzd}),'%')
		</if>
		<if test="ywx !=null and ywx !='' ">
			and s.ywx = #{ywx}
		</if>
		<if test="stSxsj!=null and stSxsj!='' ">
			and  DATE_FORMAT(s.sxsj,'%Y-%m-%d') &gt;= #{stSxsj}
		</if>
		<if test="edSxsj!=null and edSxsj!='' ">
			and DATE_FORMAT(s.sxsj,'%Y-%m-%d') &lt;= #{edSxsj}
		</if>
	 	order by cjsj  desc
	</select>
	
	<select id="getExcel" resultType="java.util.Map" parameterType="java.util.Map">
		select ${sql} 
		from t_pt_nszt_swxx 
		where 1=1 
		<if test="nsrsbh !=null and nsrsbh !='' ">
	 		and nsrsbh = #{nsrsbh}
	 	</if>
	 	<if test="gsmc !=null and gsmc !='' ">
	 		and gsmc = #{gsmc}
	 	</if>
	 	<if test="lx !=null and lx !='' ">
	 		and lx = #{lx}
	 	</if>
	 	group by uuid
	 	order by cjsj  desc
	</select>
	
	<select id="queryNsztSwxxIsExists" parameterType="java.util.Map" resultType="int">
		select  count(*) count
		from t_pt_nszt_swxx  where 1=1 
		<if test="nsrsbh !=null and nsrsbh !='' ">
	 		and nsrsbh = #{nsrsbh}
	 	</if>
	 	<if test="uuid !=null and uuid !='' ">
	 		and uuid != #{uuid}
	 	</if>
	</select>
	
	<insert id="saveNsztSwxx" parameterType="java.util.Map">
		INSERT INTO t_pt_nszt_swxx 
			(uuid,nsrsbh,gsmc,lx,ywx,
			 <if test="sxsj != null and sxsj != ''" >
	       	 	sxsj,
	      	 </if>
	      	 sshy,sykjzd,zggsjg,
			gsdtdz,gszgyxm,gszgydh,zgdsjg,dsdtdz,dszgy,dszgydh,
			bsr,cwfzr,gpr,hdszsm,cjr,cjsj,ssjtnsrsbh)
		VALUES 
			(#{uuid},#{nsrsbh}, #{gsmc}, #{lx},#{ywx},
			<if test="sxsj != null and sxsj != ''" >
	       	 	#{sxsj},
	      	</if>
			#{sshy}, #{sykjzd}, #{zggsjg},#{gsdtdz},
			#{gszgyxm},#{gszgydh}, #{zgdsjg},#{dsdtdz},#{dszgy},
			#{dszgydh},#{bsr},#{cwfzr},#{gpr},#{hdszsm},#{cjr},now(),#{ssjtnsrsbh})
	</insert> 
	
	<update id="updateNsztSwxx" parameterType="java.util.Map">
		update t_pt_nszt_swxx set
			nsrsbh=#{nsrsbh},gsmc=#{gsmc},lx=#{lx},ywx=#{ywx},
			<if test="sxsj != null and sxsj != ''" >
	       	 	sxsj=#{sxsj},
	      	 </if>
			sshy=#{sshy},sykjzd=#{sykjzd},zggsjg=#{zggsjg},gsdtdz=#{gsdtdz},
			gszgyxm=#{gszgyxm},gszgydh=#{gszgydh},zgdsjg=#{zgdsjg},dsdtdz=#{dsdtdz},dszgy=#{dszgy},
			dszgydh=#{dszgydh},bsr=#{bsr},cwfzr=#{cwfzr},gpr=#{gpr},hdszsm=#{hdszsm},
			xgr=#{xgr},xgsj=now(),ssjtnsrsbh=#{ssjtnsrsbh} 
		where uuid = #{uuid}
	</update>
	
	<delete id="deleteNsztSwxx" parameterType="String" flushCache="false">
		delete from t_pt_nszt_swxx
		where
		uuid in
		<foreach collection="list" index="index" item="item" open="(" separator="," close=")">
			#{item.uuid}
		</foreach>
	</delete>


	<select id="queryNsztSwxxListByNsrsbh" resultType="map" parameterType="java.util.List">
		select count(1) as cou from t_pt_nszt_swxx where nsrsbh in
		<foreach collection="list" index="index" item="item" open="(" separator="," close=")">
			#{item.nsrsbh}
		</foreach>
	</select>


	<insert id="saveNsztSwxxList" parameterType="java.util.ArrayList">
		insert into t_pt_nszt_swxx(
				uuid,
				nsrsbh,
				gsmc,
				lx,
				ywx,
				sxsj,
				sshy,
				sykjzd,
				zggsjg,
				gsdtdz,
				gszgyxm,
				gszgydh,
				zgdsjg,
				dsdtdz,
				dszgy,
				dszgydh,
				bsr,
				cwfzr,
				gpr,
				hdszsm,
				cjr,
				cjsj,
				xgr,
				xgsj,
				ssjtnsrsbh)
		values
		<foreach collection="list" item="check" separator=",">
		<trim prefix="(" suffix=")" suffixOverrides=",">
			REPLACE(UUID(),'-',''),
			<choose>
				<when test="check.nsrsbh != null">
					#{check.nsrsbh,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.gsmc != null">
					#{check.gsmc,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.lx != null">
					#{check.lx,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.ywx != null">
					#{check.ywx,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.sxsj != null">
					#{check.sxsj,jdbcType=DATE},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.sshy != null">
					#{check.sshy,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.sykjzd != null">
					#{check.sykjzd,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.zggsjg != null">
					#{check.zggsjg,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.gsdtdz != null">
					#{check.gsdtdz,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.gszgyxm != null">
					#{check.gszgyxm,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.gszgydh != null">
					#{check.gszgydh,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.zgdsjg != null">
					#{check.zgdsjg,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.dsdtdz != null">
					#{check.dsdtdz,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.dszgy != null">
					#{check.dszgy,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.dszgydh != null">
					#{check.dszgydh,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.bsr != null">
					#{check.bsr,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.cwfzr != null">
					#{check.cwfzr,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.gpr != null">
					#{check.gpr,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.hdszsm != null">
					#{check.hdszsm,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.cjr != null">
					#{check.cjr,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.cjsj != null">
					#{check.cjsj,jdbcType=DATE},
				</when >
				<otherwise>SYSDATE(),</otherwise>
			</choose>
			<choose>
				<when test="check.xgr != null">
					#{check.xgr,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.xgsj != null">
					#{check.xgsj,jdbcType=DATE},
				</when >
				<otherwise>null,</otherwise>
			</choose>
			<choose>
				<when test="check.ssjtnsrsbh != null">
					#{check.ssjtnsrsbh,jdbcType=VARCHAR},
				</when >
				<otherwise>null,</otherwise>
			</choose>
		</trim>
		</foreach>
	</insert>

</mapper>